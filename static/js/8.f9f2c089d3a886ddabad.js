webpackJsonp([8],{HNHf:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("yMY+"),i={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"book-read container",attrs:{id:"book-read"},on:{click:t.getMousePos,swipeleft:t.swipeLeft,swiperight:t.swipeRight}},[a("el-dialog",{attrs:{title:"设置",visible:t.centerDialogVisible,width:"90%",center:""},on:{"update:visible":function(e){t.centerDialogVisible=e}}},[a("span",[t._v("字体大小:"+t._s(t.rangeValue)+"像素（px）")]),t._v(" "),a("mt-range",{attrs:{min:12,max:48,step:2,"bar-height":5},model:{value:t.rangeValue,callback:function(e){t.rangeValue=e},expression:"rangeValue"}}),t._v(" "),a("router-link",{attrs:{to:"/Novel/NovelReadTwo"}},[a("el-button",[t._v("滚动阅读")])],1),t._v(" "),a("router-link",{attrs:{to:"/Novel/NovelReadThree"}},[a("el-button",[t._v("翻页阅读")])],1),t._v(" "),a("color-picker",{model:{value:t.color,callback:function(e){t.color=e},expression:"color"}}),t._v(" "),a("p",[t._v("\n      字体Color:\n      "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.color,expression:"color"}],attrs:{type:"text"},domProps:{value:t.color},on:{input:function(e){e.target.composing||(t.color=e.target.value)}}})]),t._v(" "),a("p",[t._v("\n      背景图:\n      "),t._v(" "),a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.bgImg,callback:function(e){t.bgImg=e},expression:"bgImg"}},t._l(t.bgImages,function(t){return a("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}))],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"})],1),t._v(" "),a("vue-drawer-layout",{ref:"drawerLayout",attrs:{enable:!1,reverse:!0},on:{"mask-click":t.handleMaskClick}},[a("div",{staticClass:"drawer-book",attrs:{slot:"drawer",id:"drawer-book"},slot:"drawer"},[a("div",{staticClass:"block"},[a("el-pagination",{attrs:{background:"","current-page":t.currentPage,"page-size":100,"pager-count":5,layout:"prev, pager, next",total:t.chapterList.length},on:{"current-change":t.handleCurrentChange}})],1),t._v(" "),t._l(t.chapterListNew,function(e,o){return a("div",{key:o,class:o+100*(t.pageVal-1)==t.page?"blue-class":"red-class",on:{click:function(a){t.toChapterMui(e.title,o)}}},[a("mt-cell",{attrs:{title:e.title}})],1)})],2),t._v(" "),a("div",{staticClass:"content",attrs:{slot:"content"},slot:"content"},[a("mt-header",{directives:[{name:"show",rawName:"v-show",value:t.showTabbar,expression:"showTabbar"}],attrs:{title:t.title}},[a("router-link",{attrs:{slot:"left",to:"/Novel/NovelDetail"},slot:"left"},[a("mt-button",{attrs:{icon:"back"}},[t._v("返回")])],1),t._v(" "),a("mt-button",{attrs:{slot:"right",icon:"more"},on:{click:t.more},slot:"right"})],1),t._v(" "),a("div",{attrs:{id:"magazine",dir:"ltr"},on:{click:function(e){t.loadPrevClick()}}},t._l(t.newHtmlArr,function(e){return a("div",{staticClass:"novel-page",style:{fontSize:t.rangeValue+"px ",fontFamily:t.myFontFamily}},t._l(e,function(e){return a("div",{domProps:{innerHTML:t._s(e)}})}))})),t._v(" "),a("mt-tabbar",{directives:[{name:"show",rawName:"v-show",value:t.showTabbar,expression:"showTabbar"}],staticStyle:{background:"none","z-index":"100"}},[a("particle-effect-button",{attrs:{hidden:t.isHidden,color:"rgb(50, 186, 250)",duration:500,type:"triangle",drawStyle:"stroke"}},[a("mt-tab-item",{staticStyle:{width:"100%"},attrs:{id:"上一章"}},[a("el-button",{staticStyle:{float:"left"},attrs:{type:"primary",icon:"el-icon-arrow-left"},on:{click:function(e){t.loadPrevMui(-1)}}},[t._v("上一章")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.sheZhi()}}},[t._v("设置")]),t._v(" "),a("el-button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:function(e){t.loadPrevMui(1)}}},[t._v("下一章"),a("i",{staticClass:"el-icon-arrow-right el-icon--right"})])],1)],1)],1)],1)])],1)},staticRenderFns:[]};var n=function(t){a("JAeV")},r=a("VU/8")(o.a,i,!1,n,"data-v-0987bb62",null);e.default=r.exports},JAeV:function(t,e){},"yMY+":function(t,e,a){"use strict";(function(t){var o=a("//Fk"),i=a.n(o),n=a("Zrlr"),r=a.n(n),s=a("wxAW"),l=a.n(s),c=a("BO1k"),u=a.n(c),h=a("mvHQ"),g=a.n(h),d=a("Dd8w"),p=a.n(d),m=a("mtWM"),f=a.n(m),v=a("Au9i"),b=(a.n(v),a("NYxO")),y=a("K8K/"),k=a.n(y),w=a("FolY"),T=(a("KYLE"),a("6Dk1"));e.a={name:"NovelReadThree",components:{ParticleEffectButton:w.a,ColorPicker:T.a},data:function(){return{bgImages:[],bgImg:"https://czy-1257069199.cos.ap-beijing.myqcloud.com/my-app/novel/bg5.jpg",color:"#000000",vueDrawerLayout:!1,loadCurrentPage:1,newHtmlArr:[],showTabbar:!1,showTabbarPreventDefult:1,isHidden:!0,fontSlot:[{flex:1,values:["Microsoft YaHei","华文楷体","宋体","楷体","none","unset"],className:"slot1"}],fontFamily:"",preCon:{precon:!0},centerDialogVisible:!1,rangeValue:16,firstLoad:!0,allLoaded:!1,bottomStatus:"",wrapperHeight:0,fullscreenLoading:!1,title:"",chapterList:[],chapterListNew:[],page:0,bodyText:"",pageVal:1,currentPage:1,theParams:""}},computed:p()({},Object(b.c)(["bookDetail","myFontFamily"])),watch:{rangeValue:{handler:function(t,e){var a=this;1==this.firstLoad?setTimeout(function(){a.handleChange(t)},1500):this.handleChange(t)}},color:{handler:function(t,e){var a=this;setTimeout(function(){var e=a.page-100*(a.pageVal-1);a.toChapterMui(a.title,e),a.onFontColorChange(t)},300)}},bgImg:{handler:function(e,a){t("#magazine .page").css("background-image","url("+e+")");var o=this.page-100*(this.pageVal-1);this.toChapterMui(this.title,o),this.bgImgChange(e),t("#magazine .page").css("background-image","url("+e+")")}}},methods:{swipeLeft:function(){this.loadCurrentPage==t("#magazine").turn("pages")?this.loadPrevMui(1):t("#magazine").turn("next")},swipeRight:function(){1==this.loadCurrentPage?this.loadPrevMui(-1):t("#magazine").turn("previous")},loadPrevClick:function(e){if(!this.vueDrawerLayout){var a=e||window.event,o=(document.getElementById("book-read"),t("#magazine").width()),i=(t("#magazine").height(),a.clientX);a.clientY;this.loadCurrentPage==t("#magazine").turn("pages")?parseInt(i/o*100)>78&&this.loadPrevMui(1):1==this.loadCurrentPage?parseInt(i/o*100)<23?(this.loadPrevMui(-1),t("#magazine").turn("page",1)):parseInt(i/o*100)>78&&t("#magazine").turn("next"):parseInt(i/o*100)>78?t("#magazine").turn("next"):parseInt(i/o*100)<23&&t("#magazine").turn("previous")}},getMousePos:function(e){var a=e||window.event,o=(document.getElementById("book-read"),t("#book-read").width()),i=t("#book-read").height(),n=a.clientX,r=a.clientY,s=0;parseInt(n/o*100)>25&&parseInt(n/o*100)<75&&parseInt(r/i*100)>30&&parseInt(r/i*100)<70&&(s=1),1==s&&this.main_log()},theDraggabilly:function(){for(var t=document.querySelectorAll(".draggable"),e=[],a=0,o=t.length;a<o;a++){var i=t[a],n=new k.a(i,{containment:!0});e.push(n)}},main_log:function(t){var e=this;console.log(t),0!=this.showTabbarPreventDefult&&(this.showTabbarPreventDefult=0,setTimeout(function(){e.showTabbarPreventDefult=1},1e3),this.isHidden=!this.isHidden,0==this.isHidden?this.showTabbar=!0:setTimeout(function(){e.showTabbar=!1},500))},onFontColorChange:function(t){var e=JSON.parse(localStorage.getItem("czyBooks"));e.fontColor=t,e=g()(e),localStorage.removeItem("czyBooks"),localStorage.setItem("czyBooks",e)},bgImgChange:function(t){var e=JSON.parse(localStorage.getItem("czyBooks"));e.bgImg=t,e=g()(e),localStorage.removeItem("czyBooks"),localStorage.setItem("czyBooks",e)},handleChange:function(t){var e=this.page-100*(this.pageVal-1);this.toChapterMui(this.title,e);var a=JSON.parse(localStorage.getItem("czyBooks"));a.fontSize=t,console.log(a),a=g()(a),localStorage.removeItem("czyBooks"),localStorage.setItem("czyBooks",a)},bookReadIndex:function(){var e=this,a=JSON.parse(localStorage.getItem("czyBooks"));this.rangeValue=a.fontSize,this.bgImg=a.bgImg||"https://czy-1257069199.cos.ap-beijing.myqcloud.com/my-app/novel/bg5.jpg",this.color=a.fontColor||"#000000";for(var o=a.books.length,i=this.bookDetail,n=0,r=0;r<o;r++)a.books[r]._id==i&&(n=a.books[r].lastReadChapterIndex);t("#magazine .page").css("background-image","url("+this.bgImg+")"),setTimeout(function(){e.page=n},50)},changeBookshelf:function(){for(var t=JSON.parse(localStorage.getItem("czyBooks")),e=t.books.length,a=this.bookDetail,o=0;o<e;o++)t.books[o]._id==a&&(t.books[o].lastReadChapter=this.chapterList[this.page].title,t.books[o].lastReadChapterIndex=this.page);t=g()(t),localStorage.removeItem("czyBooks"),localStorage.setItem("czyBooks",t),console.log(JSON.parse(localStorage.getItem("czyBooks")))},handleBottomChange:function(t){this.bottomStatus=t},loadBottom:function(){var t=this;this.firstLoad?(setTimeout(function(){t.$refs.loadmore.onBottomLoaded()},30),setTimeout(function(){},31),setTimeout(function(){t.firstLoad=!1},3e3)):setTimeout(function(){t.loadPrevMui(1),t.$refs.loadmore.onBottomLoaded()},200)},sheZhi:function(){this.centerDialogVisible=!0},openFullScreen:function(){var t=this;this.fullscreenLoading=!0,setTimeout(function(){t.fullscreenLoading=!1},500)},toChapterMui:function(t,e){this.allLoaded=!1,this.page=100*(this.pageVal-1)+e,this.getTextMui(this.chapterList),this.title=t,this.$refs.drawerLayout.toggle(!1),this.vueDrawerLayout=!1},handleCurrentChange:function(t){this.chapterListNew=this.chapterList.slice(100*(t-1),100*t),this.pageVal=t,setTimeout(function(){document.getElementById("drawer-book").scrollTop=document.getElementsByClassName("blue-class")[0].offsetTop},50)},handleMaskClick:function(){this.$refs.drawerLayout.toggle(!1),this.vueDrawerLayout=!1},more:function(){this.$refs.drawerLayout.toggle(),this.vueDrawerLayout=!0},getLinkMui:function(t){var e=this;this.$mui.ajax({url:"http://api.zhuishushenqi.com/toc/"+t+"?view=chapters",data:{},async:!0,dataType:"json",crossDomain:!0,type:"get",timeout:1e4,scriptCharset:"utf-8",headers:{"Content-Type":"application/json"},success:function(t){e.$mui.toast("请求成功");var a=t;e.chapterList=a.chapters,e.title=e.chapterList[e.page].title,e.chapterListNew=e.chapterList.slice(0,100),e.getTextMui(e.chapterList)},error:function(t,a,o){console.log(a),e.$mui.toast("请求失败")}})},getTextMui:function(e){this.currentPage=parseInt(this.page/100)+1,this.handleCurrentChange(this.currentPage);var a=this;this.$mui.ajax({url:"http://chapter2.zhuishushenqi.com/chapter/"+encodeURIComponent(e[a.page].link)+"?k=2124b73d7e2e1945&t=1468223717)",data:{},async:!0,dataType:"json",crossDomain:!0,type:"get",timeout:1e4,scriptCharset:"utf-8",headers:{"Content-Type":"application/json"},success:function(e){var o=e;if(o.ok){if(o.chapter.body.indexOf("下载最新的追书神器app阅读本作")>-1)return void Object(v.Toast)({message:"资源丢失了...",position:"bottom",duration:2e3});if(o.chapter.body.indexOf("请安装最新版追书")>-1)return void Object(v.Toast)({message:"资源丢失了...",position:"bottom",duration:2e3});a.bodyText=o.chapter.body.split("\n").join("<br>");for(var i=a.bodyText.split("<br>"),n=[],r=0;r<i.length;r++)n.push(i[r]);a.bodyText=n;for(var s=[],l=0;l<a.bodyText.length;l++)for(var c=a.bodyText[l].length,u=parseInt((t("#book-read").width()-22)/a.rangeValue),h=Math.ceil(c/u),g=a.bodyText[l],d=0;d<h;d++)if(0==d){var p='<div  style="font-size: '+a.rangeValue+"px;font-family: "+a.myFontFamily+";width: "+u*a.rangeValue+'px;" class="txt-header">'+g.substring(0,u-2)+"</div>";s.push(p)}else{var m=u-2+(d-1)*u,f=u-2+d*u,b='<div style="font-size: '+a.rangeValue+"px;font-family: "+a.myFontFamily+";width: "+u*a.rangeValue+'px;" class="txt-not-header">'+g.substring(m,f)+"</div>";s.push(b)}for(var y=[],k=parseInt((t("#book-read").height()-80)/(1.5*a.rangeValue)),w=0;w<s.length/k;w++)y[w]=s.slice(w*k,(w+1)*k);t("#magazine").width(),t("#magazine").height();!function e(){var o=t("#magazine").turn("pages");if(o<=1)for(var i=0;i<y.length;i++){for(var n="",r=0;r<y[i].length;r++)n+=y[i][r];if(1==y.length)for(var s=0;s<2;s++){var l=t("<div />").html('<div class="novel-page-con" style="background-image: url('+a.bgImg+");color: "+a.color+';">'+n+"</div>");t("#magazine").turn("addPage",l,s+1)}else{var c=t("<div />").html('<div class="novel-page-con" style="background-image: url('+a.bgImg+");color: "+a.color+';">'+n+"</div>");t("#magazine").turn("addPage",c,i+1)}}else t("#magazine").turn("removePage",o),e()}(),a.changeBookshelf(),setTimeout(function(){},200)}},error:function(t,e,o){console.log(e),a.$mui.toast("请求失败")}})},loadPrevMui:function(t){this.loadCurrentPage=1,this.allLoaded=!1,this.page=this.page+t,this.page<0?(this.page=0,Object(v.Toast)({message:"已经是第一章了...",position:"bottom",duration:2e3}),this.allLoaded=!1):this.page>=this.chapterList.length?(this.page=this.chapterList.length-1,Object(v.Toast)({message:"已经是最新章了...",position:"bottom",duration:2e3}),this.allLoaded=!0):(this.getTextMui(this.chapterList),this.title=this.chapterList[this.page].title)},getNovelMui:function(){this.loadCurrentPage=1;var t=this;this.$mui.ajax({url:"http://api.zhuishushenqi.com/toc?view=summary&book="+t.bookDetail,data:{},async:!0,dataType:"json",crossDomain:!0,type:"get",timeout:1e4,scriptCharset:"utf-8",headers:{"Content-Type":"application/json"},success:function(e){t.$mui.toast("请求成功");var a=e;console.log("theData"),console.log(a);var o=a.length>1?a[1]._id:a[0]._id,i=!0,n=!1,r=void 0;try{for(var s,l=u()(a);!(i=(s=l.next()).done);i=!0){var c=s.value;if("my176"===c.source){o=c._id;break}}}catch(t){n=!0,r=t}finally{try{!i&&l.return&&l.return()}finally{if(n)throw r}}t.getLinkMui(o)},error:function(e,a,o){console.log(a),t.$mui.toast("请求失败")}})},novel:function(){var e=this;new(function(){function a(){r()(this,a),this.sourceId=e.bookDetail,this.bookReadIndex2().then(this.getNovel2).then(this.getLink2).then(this.getText2).then(function(t){}).catch(function(t){console.log(t)})}return l()(a,[{key:"bookReadIndex2",value:function(){return new i.a(function(t,a){var o=JSON.parse(localStorage.getItem("czyBooks"));e.rangeValue=o.fontSize;for(var i=o.books.length,n=e.bookDetail,r=0,s=0;s<i;s++)o.books[s]._id==n&&(r=o.books[s].lastReadChapterIndex);setTimeout(function(){e.page=r,t()},50)})}},{key:"getNovel2",value:function(){return new i.a(function(t,a){e.$mui.ajax({url:"http://api.zhuishushenqi.com/toc?view=summary&book="+e.bookDetail,data:{},async:!0,dataType:"json",crossDomain:!0,type:"get",timeout:1e4,scriptCharset:"utf-8",headers:{"Content-Type":"application/json"},success:function(a){e.$mui.toast("请求成功");var o=a,i=o.length>1?o[1]._id:o[0]._id,n=!0,r=!1,s=void 0;try{for(var l,c=u()(o);!(n=(l=c.next()).done);n=!0){var h=l.value;if("my176"===h.source){i=h._id;break}}}catch(t){r=!0,s=t}finally{try{!n&&c.return&&c.return()}finally{if(r)throw s}}e.theParams=i,t()},error:function(t,a,o){console.log(a),e.$mui.toast("请求失败")}})})}},{key:"getLink2",value:function(){return new i.a(function(t,a){e.$mui.ajax({url:"http://api.zhuishushenqi.com/toc/"+e.theParams+"?view=chapters",data:{},async:!0,dataType:"json",crossDomain:!0,type:"get",timeout:1e4,scriptCharset:"utf-8",headers:{"Content-Type":"application/json"},success:function(a){e.$mui.toast("请求成功");var o=a;e.chapterList=o.chapters,e.title=e.chapterList[e.page].title,e.chapterListNew=e.chapterList.slice(0,100),t()},error:function(t,a,o){console.log(a),e.$mui.toast("请求失败")}})})}},{key:"getText2",value:function(){return new i.a(function(a,o){var i=e.chapterList;e.currentPage=parseInt(e.page/100)+1,e.handleCurrentChange(e.currentPage),e.$mui.ajax({url:"http://chapter2.zhuishushenqi.com/chapter/"+encodeURIComponent(i[e.page].link)+"?k=2124b73d7e2e1945&t=1468223717)",data:{},async:!0,dataType:"json",crossDomain:!0,type:"get",timeout:1e4,scriptCharset:"utf-8",headers:{"Content-Type":"application/json"},success:function(a){e.$mui.toast("请求成功");var o=a;if(o.ok){if(o.chapter.body.indexOf("下载最新的追书神器app阅读本作")>-1)return void Object(v.Toast)({message:"资源丢失了...",position:"bottom",duration:2e3});if(o.chapter.body.indexOf("请安装最新版追书")>-1)return void Object(v.Toast)({message:"资源丢失了...",position:"bottom",duration:2e3});e.bodyText=o.chapter.body.split("\n").join("<br>");for(var i=e.bodyText.split("<br>"),n=[],r=0;r<i.length;r++)n.push(i[r]);e.bodyText=n,e.changeBookshelf();for(var s=[],l=0;l<e.bodyText.length;l++)for(var c=e.bodyText[l].length,u=Math.ceil(c/12),h=e.bodyText[l],g=0;g<u;g++){if(0==g){var d='<div class="txt-header">'+h.substring(0,10)+"</div>";10,s.push(d)}else{var p=10+12*(g-1),m=10+12*g,f='<div class="txt-not-header">'+h.substring(p,m)+"</div>";s.push(f)}}for(var b=[],y=0;y<s.length/14;y++)b[y]=s.slice(14*y,14*(y+1));e.newHtmlArr=b;var k=t("#magazine").width(),w=t("#magazine").height();e.$nextTick(function(){t("#magazine").turn({width:k,height:w,display:"single",acceleration:!0,autoCenter:!1,gradients:!0,disable:!1,duration:200,when:{turning:function(t,a,o){e.loadCurrentPage=a}}})}),setTimeout(function(){var t=e.page-100*(e.pageVal-1);e.toChapterMui(e.title,t)},200)}}})})}}]),a}())}},created:function(){var t=this;setTimeout(function(){t.novel()},80);var e=this;this.$mui.back=function(){e.$router.push("/Novel/NovelBookshelf")},setTimeout(function(){},100)},mounted:function(){var t=this;this.bookReadIndex(),f.a.get("https://raw.githubusercontent.com/czy19950220/study/master/src/assets/js/bgImg.json").then(function(e){t.bgImages=e.data.bgImg})},beforeRouteLeave:function(t,e,a){this.firstLoad=!0,a()}}}).call(e,a("7t+N"))}});