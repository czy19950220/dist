webpackJsonp([9],{"4m3c":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=a("8EkD"),n={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"book-read container",attrs:{id:"book-read"},on:{click:t.getMousePos,swipeleft:t.swipeLeft,swiperight:t.swipeRight}},[a("el-dialog",{attrs:{title:"设置",visible:t.centerDialogVisible,width:"90%",center:""},on:{"update:visible":function(e){t.centerDialogVisible=e}}},[a("span",[t._v("字体大小:"+t._s(t.rangeValue)+"像素（px）")]),t._v(" "),a("mt-range",{attrs:{min:12,max:48,step:2,"bar-height":5},model:{value:t.rangeValue,callback:function(e){t.rangeValue=e},expression:"rangeValue"}}),t._v(" "),a("router-link",{attrs:{to:"/NovelDev/NovelRead"}},[a("el-button",[t._v("滚动阅读")])],1),t._v(" "),a("router-link",{attrs:{to:"/NovelDev/NovelReadDevThree"}},[a("el-button",[t._v("翻页阅读")])],1),t._v(" "),a("color-picker",{model:{value:t.color,callback:function(e){t.color=e},expression:"color"}}),t._v(" "),a("p",[t._v("\n      字体Color:\n      "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.color,expression:"color"}],attrs:{type:"text"},domProps:{value:t.color},on:{input:function(e){e.target.composing||(t.color=e.target.value)}}})]),t._v(" "),a("p",[t._v("\n      背景图:\n      "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.bgImg,expression:"bgImg"}],attrs:{type:"text"},domProps:{value:t.bgImg},on:{input:function(e){e.target.composing||(t.bgImg=e.target.value)}}})]),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"})],1),t._v(" "),a("vue-drawer-layout",{ref:"drawerLayout",attrs:{enable:!1,reverse:!0},on:{"mask-click":t.handleMaskClick}},[a("div",{staticClass:"drawer-book",attrs:{slot:"drawer",id:"drawer-book"},slot:"drawer"},[a("div",{staticClass:"block"},[a("el-pagination",{attrs:{background:"","current-page":1,"page-size":100,"pager-count":5,layout:"prev, pager, next",total:t.chapterList.length},on:{"current-change":t.handleCurrentChange}})],1),t._v(" "),t._l(t.chapterListNew,function(e,o){return a("div",{key:o,class:o+100*(t.pageVal-1)==t.page?"blue-class":"red-class",on:{click:function(a){t.toChapter(e.title,o)}}},[a("mt-cell",{attrs:{title:e.title}})],1)})],2),t._v(" "),a("div",{staticClass:"content",attrs:{slot:"content"},slot:"content"},[a("mt-header",{directives:[{name:"show",rawName:"v-show",value:t.showTabbar,expression:"showTabbar"}],attrs:{title:t.title}},[a("router-link",{attrs:{slot:"left",to:"/NovelDev/NovelDetailDev"},slot:"left"},[a("mt-button",{attrs:{icon:"back"}},[t._v("返回")])],1),t._v(" "),a("mt-button",{attrs:{slot:"right",icon:"more"},on:{click:t.more},slot:"right"})],1),t._v(" "),a("div",{attrs:{id:"magazine",dir:"ltr"},on:{click:function(e){t.loadPrevClick()}}},t._l(t.newHtmlArr,function(e){return a("div",{staticClass:"novel-page",style:{fontSize:t.rangeValue+"px ",fontFamily:t.myFontFamily}},t._l(e,function(e){return a("div",{domProps:{innerHTML:t._s(e)}})}))})),t._v(" "),a("mt-tabbar",{directives:[{name:"show",rawName:"v-show",value:t.showTabbar,expression:"showTabbar"}],staticStyle:{background:"none","z-index":"100"}},[a("particle-effect-button",{attrs:{hidden:t.isHidden,color:"rgb(50, 186, 250)",duration:500,type:"triangle",drawStyle:"stroke"}},[a("mt-tab-item",{staticStyle:{width:"100%"},attrs:{id:"上一章"}},[a("el-button",{staticStyle:{float:"left"},attrs:{type:"primary",icon:"el-icon-arrow-left"},on:{click:function(e){t.loadPrev(-1)}}},[t._v("上一章")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(e){t.sheZhi()}}},[t._v("设置")]),t._v(" "),a("el-button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:function(e){t.loadPrev(1)}}},[t._v("下一章"),a("i",{staticClass:"el-icon-arrow-right el-icon--right"})])],1)],1)],1)],1)])],1)},staticRenderFns:[]};var i=function(t){a("KuN4")},r=a("VU/8")(o.a,n,!1,i,"data-v-8305e456",null);e.default=r.exports},"8EkD":function(t,e,a){"use strict";(function(t){var o=a("//Fk"),n=a.n(o),i=a("Zrlr"),r=a.n(i),s=a("wxAW"),l=a.n(s),c=a("BO1k"),u=a.n(c),g=a("mvHQ"),h=a.n(g),d=a("Dd8w"),p=a.n(d),v=a("mtWM"),m=a.n(v),f=a("Au9i"),b=(a.n(f),a("NYxO")),y=a("K8K/"),k=a.n(y),w=a("FolY"),T=(a("KYLE"),a("6Dk1"));e.a={name:"NovelReadDevThree",components:{ParticleEffectButton:w.a,ColorPicker:T.a},data:function(){return{bgImg:"https://czy-1257069199.cos.ap-beijing.myqcloud.com/my-app/novel/bg5.jpg",color:"#000000",vueDrawerLayout:!1,loadCurrentPage:1,newHtmlArr:[],showTabbar:!1,showTabbarPreventDefult:1,isHidden:!0,fontSlot:[{flex:1,values:["Microsoft YaHei","华文楷体","宋体","楷体","none","unset"],className:"slot1"}],fontFamily:"",preCon:{precon:!0},centerDialogVisible:!1,rangeValue:16,firstLoad:1,allLoaded:!1,bottomStatus:"",wrapperHeight:0,pickerValue:"",fullscreenLoading:!1,title:"",chapterList:[],chapterListNew:[],page:0,bodyText:"",pageVal:1,theParams:"111"}},computed:p()({},Object(b.c)(["bookDetail","myFontFamily"])),watch:{rangeValue:{handler:function(t,e){var a=this;1==this.firstLoad?setTimeout(function(){a.handleChange(t)},1500):this.handleChange(t)}},color:{handler:function(t,e){var a=this;setTimeout(function(){var e=a.page-100*(a.pageVal-1);a.toChapter(a.title,e),a.onFontColorChange(t)},300)}},bgImg:{handler:function(e,a){var o=this;setTimeout(function(){var a=o.page-100*(o.pageVal-1);o.toChapter(o.title,a),o.bgImgChange(e),t("#magazine .page").css("background-image","url("+e+")")},300)}}},methods:{swipeLeft:function(){this.loadCurrentPage==t("#magazine").turn("pages")?this.loadPrev(1):t("#magazine").turn("next")},swipeRight:function(){1==this.loadCurrentPage?this.loadPrev(-1):t("#magazine").turn("previous")},loadPrevClick:function(e){if(!this.vueDrawerLayout){var a=e||window.event,o=(document.getElementById("book-read"),t("#magazine").width()),n=(t("#magazine").height(),a.clientX);a.clientY;this.loadCurrentPage==t("#magazine").turn("pages")?parseInt(n/o*100)>78&&this.loadPrev(1):1==this.loadCurrentPage?parseInt(n/o*100)<23?(this.loadPrev(-1),t("#magazine").turn("page",1)):parseInt(n/o*100)>78&&t("#magazine").turn("next"):parseInt(n/o*100)>78?t("#magazine").turn("next"):parseInt(n/o*100)<23&&t("#magazine").turn("previous")}},getMousePos:function(e){var a=e||window.event,o=(document.getElementById("book-read"),t("#book-read").width()),n=t("#book-read").height(),i=a.clientX,r=a.clientY;1==(parseInt(i/o*100)>25&&parseInt(i/o*100)<75&&parseInt(r/n*100)>30&&parseInt(r/n*100)<70?1:0)&&this.main_log()},theDraggabilly:function(){for(var t=document.querySelectorAll(".draggable"),e=[],a=0,o=t.length;a<o;a++){var n=t[a],i=new k.a(n,{containment:!0});e.push(i)}},main_log:function(){var t=this;0!=this.showTabbarPreventDefult&&(this.showTabbarPreventDefult=0,setTimeout(function(){t.showTabbarPreventDefult=1},800),this.isHidden=!this.isHidden,0==this.isHidden?this.showTabbar=!0:setTimeout(function(){t.showTabbar=!1},500))},onFontColorChange:function(t){var e=JSON.parse(localStorage.getItem("czyBooks"));e.fontColor=t,e=h()(e),localStorage.removeItem("czyBooks"),localStorage.setItem("czyBooks",e)},bgImgChange:function(t){var e=JSON.parse(localStorage.getItem("czyBooks"));e.bgImg=t,e=h()(e),localStorage.removeItem("czyBooks"),localStorage.setItem("czyBooks",e)},handleChange:function(t){var e=this.page-100*(this.pageVal-1);this.toChapter(this.title,e);var a=JSON.parse(localStorage.getItem("czyBooks"));a.fontSize=parseInt(t),a=h()(a),localStorage.removeItem("czyBooks"),localStorage.setItem("czyBooks",a)},bookReadIndex:function(){var e=JSON.parse(localStorage.getItem("czyBooks"));this.rangeValue=e.fontSize,this.bgImg=e.bgImg||"https://czy-1257069199.cos.ap-beijing.myqcloud.com/my-app/novel/bg5.jpg",this.color=e.fontColor||"#000000";for(var a=e.books.length,o=this.bookDetail,n=0,i=0;i<a;i++)e.books[i]._id==o&&(n=e.books[i].lastReadChapterIndex);t("#magazine .page").css("background-image","url("+this.bgImg+")"),this.page=n},changeBookshelf:function(){for(var t=JSON.parse(localStorage.getItem("czyBooks")),e=t.books.length,a=this.bookDetail,o=0;o<e;o++)t.books[o]._id==a&&(t.books[o].lastReadChapter=this.chapterList[this.page].title,t.books[o].lastReadChapterIndex=this.page);t=h()(t),localStorage.removeItem("czyBooks"),localStorage.setItem("czyBooks",t)},handleBottomChange:function(t){this.bottomStatus=t},loadBottom:function(){var t=this;1==this.firstLoad?(setTimeout(function(){t.$refs.loadmore.onBottomLoaded()},30),setTimeout(function(){document.getElementsByClassName("page-loadmore-wrapper")[0].scrollTop=0},31),setTimeout(function(){t.firstLoad=0},3e3)):setTimeout(function(){t.loadPrev(1)},200)},sheZhi:function(){this.centerDialogVisible=!0},openFullScreen:function(){var t=this;this.fullscreenLoading=!0,setTimeout(function(){t.fullscreenLoading=!1},500)},toChapter:function(t,e){this.allLoaded=!1,this.page=100*(this.pageVal-1)+e,this.getText(this.chapterList),this.title=t,this.$refs.drawerLayout.toggle(!1),this.vueDrawerLayout=!1},handleCurrentChange:function(t){this.chapterListNew=this.chapterList.slice(100*(t-1),100*t),this.pageVal=t,setTimeout(function(){document.getElementById("drawer-book").scrollTop=document.getElementsByClassName("blue-class")[0].offsetTop},200)},handleMaskClick:function(){this.$refs.drawerLayout.toggle(!1),this.vueDrawerLayout=!1},more:function(){this.$refs.drawerLayout.toggle(),this.vueDrawerLayout=!0},getLink:function(t){var e=this,a="/api/toc/"+t+"?view=chapters";m.a.get(a).then(function(t){if(200==t.status){var a=t.data;e.chapterList=a.chapters,e.title=e.chapterList[e.page].title,e.chapterListNew=e.chapterList.slice(0,100),e.getText(e.chapterList)}}).catch(function(t){console.log(t),Object(f.Toast)({message:"资源没找到...",position:"bottom",duration:2e3})})},getText:function(e){var a=this;this.currentPage=parseInt(this.page/100)+1,this.handleCurrentChange(this.currentPage),m.a.get("/chapter/"+encodeURIComponent(e[this.page].link)+"?k=2124b73d7e2e1945&t=1468223717)").then(function(e){if(200==e.status){var o=e.data;if(o.ok){if(o.chapter.body.indexOf("下载最新的追书神器app阅读本作")>-1)return void Object(f.Toast)({message:"资源丢失了...",position:"bottom",duration:2e3});if(o.chapter.body.indexOf("请安装最新版追书")>-1)return void Object(f.Toast)({message:"资源丢失了...",position:"bottom",duration:2e3});a.bodyText=o.chapter.body.split("\n").join("<br>");for(var n=a.bodyText.split("<br>"),i=[],r=0;r<n.length;r++)i.push(n[r]);a.bodyText=i;for(var s=[],l=0;l<a.bodyText.length;l++)for(var c=a.bodyText[l].length,u=parseInt((t("#book-read").width()-22)/a.rangeValue),g=Math.ceil(c/u),h=a.bodyText[l],d=0;d<g;d++)if(0==d){var p='<div  style="font-size: '+a.rangeValue+"px;font-family: "+a.myFontFamily+";width: "+u*a.rangeValue+'px;" class="txt-header">'+h.substring(0,u-2)+"</div>";s.push(p)}else{var v=u-2+(d-1)*u,m=u-2+d*u,b='<div style="font-size: '+a.rangeValue+"px;font-family: "+a.myFontFamily+";width: "+u*a.rangeValue+'px;" class="txt-not-header">'+h.substring(v,m)+"</div>";s.push(b)}for(var y=[],k=parseInt((t("#book-read").height()-80)/(1.5*a.rangeValue)),w=0;w<s.length/k;w++)y[w]=s.slice(w*k,(w+1)*k);t("#magazine").width(),t("#magazine").height();var T=a;!function e(){var a=t("#magazine").turn("pages");if(a<=1)for(var o=0;o<y.length;o++){for(var n="",i=0;i<y[o].length;i++)n+=y[o][i];if(1==y.length)for(var r=0;r<2;r++){var s=t("<div />").html('<div class="novel-page-con" style="background-image: url('+T.bgImg+");color: "+T.color+';">'+n+"</div>");t("#magazine").turn("addPage",s,r+1)}else{var l=t("<div />").html('<div class="novel-page-con" style="background-image: url('+T.bgImg+");color: "+T.color+';">'+n+"</div>");t("#magazine").turn("addPage",l,o+1)}}else t("#magazine").turn("removePage",a),e()}(),a.changeBookshelf()}}}).catch(function(t){console.log(t),Object(f.Toast)({message:"资源没找到",position:"bottom",duration:2e3})})},loadPrev:function(t){this.loadCurrentPage=1,this.page=this.page+t,this.page<0?(this.page=0,Object(f.Toast)({message:"已经是第一章了...",position:"bottom",duration:2e3}),this.allLoaded=!1):this.page>=this.chapterList.length?(this.page=this.chapterList.length-1,Object(f.Toast)({message:"已经是最新章了...",position:"bottom",duration:2e3}),this.allLoaded=!0):(this.getText(this.chapterList),this.title=this.chapterList[this.page].title)},getNovel:function(){var t=this;m.a.get("/api/toc?view=summary&book="+this.bookDetail).then(function(e){if(200==e.status){var a=e.data,o=a.length>1?a[1]._id:a[0]._id,n=!0,i=!1,r=void 0;try{for(var s,l=u()(a);!(n=(s=l.next()).done);n=!0){var c=s.value;if("my176"===c.source){o=c._id;break}}}catch(t){i=!0,r=t}finally{try{!n&&l.return&&l.return()}finally{if(i)throw r}}t.getLink(o)}Object(f.Toast)({message:"加载成功",position:"bottom",duration:2e3})}).catch(function(t){Object(f.Toast)({message:"资源没找到...",position:"bottom",duration:2e3})})},novel:function(){var e=this;new(function(){function a(){r()(this,a),this.sourceId=e.bookDetail,this.getNovel2().then(this.getLink2).then(this.getText2).then(function(t){}).catch(function(t){console.log(t)})}return l()(a,[{key:"getNovel2",value:function(){var t=this;return new n.a(function(a,o){m.a.get("/api/toc?view=summary&book="+t.sourceId).then(function(t){if(200==t.status){var o=t.data,n=o.length>1?o[1]._id:o[0]._id,i=!0,r=!1,s=void 0;try{for(var l,c=u()(o);!(i=(l=c.next()).done);i=!0){var g=l.value;if("my176"===g.source){n=g._id;break}}}catch(t){r=!0,s=t}finally{try{!i&&c.return&&c.return()}finally{if(r)throw s}}e.theParams=n,a()}}).catch(function(t){Object(f.Toast)({message:"资源没找到...",position:"bottom",duration:2e3})})})}},{key:"getLink2",value:function(){return new n.a(function(t,a){var o="/api/toc/"+e.theParams+"?view=chapters";m.a.get(o).then(function(a){if(200==a.status){var o=a.data;e.chapterList=o.chapters,e.title=e.chapterList[e.page].title,e.chapterListNew=e.chapterList.slice(0,100),t()}}).catch(function(t){console.log(t),Object(f.Toast)({message:"资源没找到...",position:"bottom",duration:2e3})})})}},{key:"getText2",value:function(){return new n.a(function(a,o){var n=e.chapterList;e.currentPage=parseInt(e.page/100)+1,m.a.get("/chapter/"+encodeURIComponent(n[e.page].link)+"?k=2124b73d7e2e1945&t=1468223717)").then(function(a){if(200==a.status){var o=a.data;if(o.ok){if(o.chapter.body.indexOf("下载最新的追书神器app阅读本作")>-1)return void Object(f.Toast)({message:"资源丢失了...",position:"bottom",duration:2e3});if(o.chapter.body.indexOf("请安装最新版追书")>-1)return void Object(f.Toast)({message:"资源丢失了...",position:"bottom",duration:2e3});e.bodyText=o.chapter.body.split("\n").join("<br>");for(var n=e.bodyText.split("<br>"),i=[],r=0;r<n.length;r++)i.push(n[r]);e.bodyText=i,e.changeBookshelf();for(var s=[],l=0;l<e.bodyText.length;l++)for(var c=e.bodyText[l].length,u=Math.ceil(c/12),g=e.bodyText[l],h=0;h<u;h++){if(0==h){var d='<div class="txt-header">'+g.substring(0,10)+"</div>";10,s.push(d)}else{var p=10+12*(h-1),v=10+12*h,m='<div class="txt-not-header">'+g.substring(p,v)+"</div>";s.push(m)}}for(var b=[],y=0;y<s.length/14;y++)b[y]=s.slice(14*y,14*(y+1));e.newHtmlArr=b;var k=t("#magazine").width(),w=t("#magazine").height();e.$nextTick(function(){t("#magazine").turn({width:k,height:w,display:"single",acceleration:!0,autoCenter:!1,gradients:!0,disable:!1,duration:200,when:{turning:function(t,a,o){e.loadCurrentPage=a}}})}),setTimeout(function(){var t=e.page-100*(e.pageVal-1);e.toChapter(e.title,t)},200)}}}).catch(function(t){Object(f.Toast)({message:"资源没找到",position:"bottom",duration:2e3})})})}}]),a}())}},created:function(){this.novel()},mounted:function(){this.bookReadIndex()},beforeRouteLeave:function(t,e,a){this.firstLoad=1,a()}}}).call(e,a("7t+N"))},KuN4:function(t,e){}});